<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Expense Tracker</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-6">
  <h1 class="text-3xl font-bold text-center text-blue-600 mb-6">Expense Tracker</h1>

  <!-- Error / success messages -->
  <div id="messages" class="text-center mb-4 text-red-600 font-semibold"></div>

  <!-- Form -->
  <div class="max-w-md mx-auto bg-white p-6 rounded-lg shadow-md mb-6">
    <form id="expense-form" class="space-y-4">
      <input type="text" id="description" placeholder="Description" class="w-full border p-2 rounded" required />
      <input type="number" id="amount" placeholder="Amount" class="w-full border p-2 rounded" required />
      <select id="category" class="w-full border p-2 rounded" required>
        <option value="">Select Category</option>
        <option value="Food">Food</option>
        <option value="Transport">Transport</option>
        <option value="Shopping">Shopping</option>
        <option value="Bills">Bills</option>
      </select>
      <button type="submit" class="w-full bg-blue-600 text-white p-2 rounded hover:bg-blue-700">Add Expense</button>
    </form>
  </div>

  <!-- Expense list -->
  <div class="max-w-md mx-auto bg-white p-6 rounded-lg shadow-md">
    <h2 class="text-xl font-bold mb-4">Expenses</h2>
    <ul id="expense-list" class="space-y-2"></ul>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js";

    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyBG42OrS2R0lt17SKfwKaTgycMsk_ssqNI",
      authDomain: "debby-expense-tracker-app.firebaseapp.com",
      projectId: "debby-expense-tracker-app",
      storageBucket: "debby-expense-tracker-app.firebasestorage.app",
      messagingSenderId: "527529857701",
      appId: "1:527529857701:web:f01646b2afb442438d334c",
      measurementId: "G-CJEE12XD97"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const messages = document.getElementById("messages");
    const expenseForm = document.getElementById("expense-form");
    const expenseList = document.getElementById("expense-list");
    const expenseRef = collection(db, "expenses");

    // Show error or success messages
    function showMessage(msg, isError = true) {
      messages.textContent = msg;
      messages.className = isError ? "text-center mb-4 text-red-600 font-semibold"
                                   : "text-center mb-4 text-green-600 font-semibold";
      setTimeout(() => messages.textContent = "", 5000);
    }

    // Add expense
    expenseForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const description = document.getElementById("description").value;
      const amount = document.getElementById("amount").value;
      const category = document.getElementById("category").value;

      try {
        await addDoc(expenseRef, { description, amount: parseFloat(amount), category, date: new Date() });
        showMessage("‚úÖ Expense added successfully!", false);
        expenseForm.reset();
        loadExpenses();
      } catch (err) {
        showMessage("‚ùå Error adding expense: " + err.message);
      }
    });

    // Load expenses
    async function loadExpenses() {
      expenseList.innerHTML = "";
      try {
        const snapshot = await getDocs(expenseRef);
        snapshot.forEach((docSnap) => {
          const expense = docSnap.data();
          const li = document.createElement("li");
          li.className = "flex justify-between items-center bg-gray-50 p-2 rounded";
          li.innerHTML = `
            <span>${expense.description} - ‚Ç¶${expense.amount} (${expense.category})</span>
            <button data-id="${docSnap.id}" class="text-red-600 hover:underline">Delete</button>
          `;
          li.querySelector("button").addEventListener("click", async () => {
            try {
              await deleteDoc(doc(db, "expenses", docSnap.id));
              showMessage("üóëÔ∏è Expense deleted", false);
              loadExpenses();
            } catch (err) {
              showMessage("‚ùå Error deleting expense: " + err.message);
            }
          });
          expenseList.appendChild(li);
        });
      } catch (err) {
        showMessage("‚ùå Error loading expenses: " + err.message);
      }
    }

    // Initial load
    loadExpenses();
  </script>
</body>
</html>
