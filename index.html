<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Debby Expense Tracker</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script type="module">
    // Import Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
    import {
      getFirestore,
      collection,
      addDoc,
      getDocs,
      deleteDoc,
      doc,
      updateDoc,
      onSnapshot
    } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js";

    // Your Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyBG42OrS2R0lt17SKfwKaTgycMsk_ssqNI",
      authDomain: "debby-expense-tracker-app.firebaseapp.com",
      projectId: "debby-expense-tracker-app",
      storageBucket: "debby-expense-tracker-app.appspot.com",
      messagingSenderId: "527529857701",
      appId: "1:527529857701:web:f01646b2afb442438d334c",
      measurementId: "G-CJEE12XD97"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const expensesCol = collection(db, "expenses");

    // UI elements
    const form = document.getElementById("expense-form");
    const list = document.getElementById("expense-list");
    const balanceEl = document.getElementById("balance");
    const incomeEl = document.getElementById("income");
    const expenseEl = document.getElementById("expense");

    let editingId = null;

    // Add or update expense
    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const desc = form.description.value;
      const amount = parseFloat(form.amount.value);
      const category = form.category.value;

      if (editingId) {
        const ref = doc(db, "expenses", editingId);
        await updateDoc(ref, { description: desc, amount, category });
        editingId = null;
      } else {
        await addDoc(expensesCol, {
          description: desc,
          amount,
          category,
          date: new Date().toISOString()
        });
      }

      form.reset();
    });

    // Render expenses in real-time
    onSnapshot(expensesCol, (snapshot) => {
      let expenses = [];
      snapshot.forEach((doc) => {
        expenses.push({ id: doc.id, ...doc.data() });
      });

      render(expenses);
    });

    function render(expenses) {
      list.innerHTML = "";
      let income = 0, expense = 0;

      expenses.forEach((ex) => {
        if (ex.amount > 0) income += ex.amount;
        else expense += Math.abs(ex.amount);

        const li = document.createElement("li");
        li.className =
          "flex justify-between items-center p-3 border-b bg-white shadow-sm rounded mb-2";

        li.innerHTML = `
          <div>
            <p class="font-semibold">${ex.description}</p>
            <p class="text-sm text-gray-500">${ex.category} ‚Ä¢ ${new Date(ex.date).toLocaleDateString()}</p>
          </div>
          <div class="flex items-center gap-3">
            <span class="${ex.amount > 0 ? "text-green-600" : "text-red-600"} font-bold">
              ${ex.amount > 0 ? "+" : "-"}‚Ç¶${Math.abs(ex.amount).toFixed(2)}
            </span>
            <button class="text-blue-500" onclick="editExpense('${ex.id}','${ex.description}',${ex.amount},'${ex.category}')">‚úèÔ∏è</button>
            <button class="text-red-500" onclick="deleteExpense('${ex.id}')">üóëÔ∏è</button>
          </div>
        `;
        list.appendChild(li);
      });

      const balance = income - expense;
      balanceEl.textContent = "‚Ç¶" + balance.toFixed(2);
      incomeEl.textContent = "‚Ç¶" + income.toFixed(2);
      expenseEl.textContent = "‚Ç¶" + expense.toFixed(2);
    }

    // Expose functions
    window.deleteExpense = async (id) => {
      await deleteDoc(doc(db, "expenses", id));
    };

    window.editExpense = (id, description, amount, category) => {
      form.description.value = description;
      form.amount.value = amount;
      form.category.value = category;
      editingId = id;
    };
  </script>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center p-6">
  <h1 class="text-3xl font-bold mb-6">üí∞ Debby Expense Tracker</h1>

  <!-- Dashboard -->
  <div class="grid grid-cols-3 gap-4 w-full max-w-3xl mb-6">
    <div class="bg-white p-4 rounded-xl shadow text-center">
      <p class="text-gray-500">Balance</p>
      <p id="balance" class="text-xl font-bold">‚Ç¶0.00</p>
    </div>
    <div class="bg-green-50 p-4 rounded-xl shadow text-center">
      <p class="text-gray-500">Income</p>
      <p id="income" class="text-xl font-bold text-green-600">‚Ç¶0.00</p>
    </div>
    <div class="bg-red-50 p-4 rounded-xl shadow text-center">
      <p class="text-gray-500">Expenses</p>
      <p id="expense" class="text-xl font-bold text-red-600">‚Ç¶0.00</p>
    </div>
  </div>

  <!-- Form -->
  <form id="expense-form" class="bg-white p-6 rounded-xl shadow w-full max-w-3xl mb-6 grid grid-cols-4 gap-4">
    <input type="text" name="description" placeholder="Description" required class="col-span-2 p-2 border rounded">
    <input type="number" step="0.01" name="amount" placeholder="Amount" required class="p-2 border rounded">
    <select name="category" required class="p-2 border rounded">
      <option value="">Category</option>
      <option>Food</option>
      <option>Transport</option>
      <option>Bills</option>
      <option>Shopping</option>
      <option>Other</option>
    </select>
    <button class="bg-blue-600 text-white rounded p-2 col-span-4">Save</button>
  </form>

  <!-- Expense List -->
  <ul id="expense-list" class="w-full max-w-3xl"></ul>
</body>
</html>
